!function(){this.inArray=[].indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1},this.glob=function(e){for(var t=e.split("."),o=window,i=0,n=t.length;i<n;i++)a=t[i],o[a]=o[a]||{},o=o[a];return o},glob("ldbck");var e,t,o,i,w=ldbck;if(window._emv){if(window.ldbck_loaded)return w.log("multiple instance detected"),!1;window.ldbck_loaded=!0}if(w.DEBUG=!1,w.ACCEPT_CHATS=!1,w.version="v1.12.22b21022023",w.DOMAIN=w.DEBUG?"leadback.local":"string"==typeof _emv.cdn?_emv.cdn:"leadback.ru",w.CHAT_CDN=w.DEBUG?"//cloudim.local/js/":"//cloudim.ru/js/",w.JQUERY_URL="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js?ldbck_v="+w.version,w.JS_CDN="//"+w.DOMAIN+"/js/",w.PUBLIC_SERVER=(w.DEBUG?"//":"https://")+w.DOMAIN+"/",w.JQUERY_VERSIONS="3.3.1 3.2.1 3.1.1 2.2.4 2.1.1 1.12.4 1.11.3 1.11.2 1.11.1 1.11.0 1.10.2 1.10.1 1.10.0 1.9.1 1.9.0".split(" "),w.LAST_SPEED=w.LEAVE_POINT=w.LAST_X_POSITION=w.LAST_Y_POSITION=0,w.timer=27e3,w.activity=0,w.clock=null,w.stat={x:null,y:null,s:null,t:0,a:0,l:0},w.total_time=0,w.last_visit_timeout=0,w.visit_date=null,w.Chat={},w.storage=null,w.dom_is_ready=null,w.restarted=!1,w.is_multibutton=null,w.$multibutton=null,w.beforeOpenWidget=null,w.successCallCallback=null,w.chat_settings=null,w.form_settings=null,"function"==typeof _emv.successCallCallback&&(w.successCallCallback=_emv.successCallCallback),w.onApiReady=[],"function"==typeof _emv.onApiReady)w.onApiReady.push(_emv.onApiReady);else if("object"==typeof _emv.onApiReady)for(var n=0,l=_emv.onApiReady.length;n<l;n++)"function"==typeof _emv.onApiReady[n]&&w.onApiReady.push(_emv.onApiReady[n]);w.is_vk=_emv.is_vk||!1,w.debug_window=_emv.debug_window||!1;try{w.screen_width=Math.min(window.screen.availWidth,window.screen.availHeight),w.screen_height=Math.max(window.screen.availWidth,window.screen.availHeight)}catch(e){}h=_emv.campaign,w.cc="__leadback_"+h,w.ct="__leadback_timeout_"+h,w.cg="__leadback_guid_"+h,w.storage_type="cookie",w.countDownInterval=null,w.replacedTags={},-1!=w.DOMAIN.indexOf("leadback.")&&(window.GoogleAnalyticsObject||(e=window,t=document,i="script",o="ga",e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,o=t.createElement(i),i=t.getElementsByTagName(i)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",i.parentNode.insertBefore(o,i)),"function"==typeof ga&&(ga("create","UA-53479583-2","auto",{name:"ldbckTracker"}),ga("ldbckTracker.send","pageview"))),w.ga_cid=null,"function"==typeof ga&&ga(function(){w.getGoogleCid()});var r=0,s=setInterval(function(){r++,w.getGoogleCid()?(w.log("Ga cid found",w.getGoogleCid()),s&&(clearInterval(s),s=null)):5<r&&(s&&(clearInterval(s),s=null),w.log("Ga cid not found by interval"))},500);w.getGoogleCid=function(){return null===w.ga_cid&&"function"==typeof ga&&"function"==typeof ga.getAll&&ga.getAll().length&&(w.ga_cid=ga.getAll()[0].get("clientId"),s&&(clearInterval(s),s=null)),w.log("getGoogleCid",w.ga_cid),w.ga_cid},w.ya=[],w.ya_cid=null,w.ya_counter=null;var d=0,u=setInterval(function(){for(var e in d++,window)0==e.indexOf("yaCounter")&&("function"==typeof window[e].getClientID&&null===w.ya_cid&&(w.ya_cid=window[e].getClientID(),w.ya_counter=e.toLowerCase().replace("yacounter",""),w.log("YA CID:"+w.ya_cid),w.log("YA COUNTER:"+w.ya_counter)),"function"==typeof window[e].reachGoal&&(w.ya[w.ya.length]=e,w.log("Ya: "+w.ya.length)));0<w.ya.length?clearInterval(u):5<d&&(clearInterval(u),w.log("Ya not found"))},500);function _(){for(var e=0,t={};e<arguments.length;e++){var o,i=arguments[e];for(o in i)t[o]=i[o]}return t}if(w.init=function(){w.log("init");try{var e=document.location.href,t=-1!==e.indexOf("&_cobrowsing=true")||-1!==e.indexOf("?_cobrowsing=true"),o=-1!==document.location.hash.indexOf("magic_forms_wizard");if(window!=window.top&&!w.is_vk||t)return w.log("in frame"),void(o&&(w.log("FORMS WIZARD",w.JS_CDN+"/magic_forms_wizard/magic_forms_wizard.js?v="+w.version),w.loadScript(w.JS_CDN+"/magic_forms_wizard/magic_forms_wizard.js?v="+w.version,!0,function(){w.log("WIZARD Forms Loaded",LeadbackMagicFormsWizard),new LeadbackMagicFormsWizard(w.$,w.DEBUG)})))}catch(e){}w.activity=w.DEBUG?1:w.randomVal(10,20),w.$.ajaxSetup({async:!0}),w.storage_type="local";try{void 0!==w.Cookies.get("__leadback_ver")&&(w.Cookies.remove(w.cc,{path:"/"}),w.Cookies.remove(w.ct,{path:"/"}),w.Cookies.remove("__leadback_ver",{path:"/"}))}catch(e){}return w.log("Storage type is: "+w.storage_type),w.storage=w.initStorage(_emv.campaign),w.initWidget()},w.getStorageType=function(e){var t=w.storage_type;return t=e==w.cg&&!w.is_vk?"cookie":t},w.getCookie=function(e){var t=w.getStorageType(e);if("cookie"==t)return w.Cookies.getJSON(e);if("local"==t){t=w.storage.localStorage.get(e);return void 0===t?t:void 0!==t.expires&&"string"==typeof t.expires&&new Date(t.expires)<new Date?void w.removeCookie(e):t.value}},w.setCookie=function(e,t,o){var i=w.getStorageType(e);return"cookie"==i?w.Cookies.set(e,t,o):"local"==i?(void 0===o.expires&&(o.expires=0),w.storage.localStorage.set(e,{value:t,expires:o.expires})):void 0},w.removeCookie=function(e,t){var o=w.getStorageType(e);return"cookie"==o?w.Cookies.remove(e,t):"local"==o?w.storage.localStorage.remove(e):void 0},w.restart=function(e){return w.restarted=!0,w.unloadWidget(),w.timer=27e3,w.clock=null,w.stat={x:null,y:null,s:null,t:0,a:0,l:0},w.total_time=0,w.last_visit_timeout=0,w.Chat={},w.storage=null,w.dom_is_ready=null,e&&w.restartStorage(e),w.$("#lb_widget-root").remove(),w.initWidget()},w.restartStorage=function(e){_emv.campaign=e,w.cc="__leadback_"+e,w.ct="__leadback_timeout_"+e,w.cg="__leadback_guid_"+e,w.storage=w.initStorage(e)},w.initWidget=function(){if(w.log("initWidget"),"#demomode"!=window.location.hash&&"#debug"!=window.location.hash||(w.log("Demo mode ON"),w.removeCookie(w.cc,{path:"/"}),w.removeCookie(w.ct,{path:"/"}),void 0!==w.getCookie(w.cg)&&w.setCookie(w.cg,{guid:w.getCookie(w.cg).guid,converted:!1,t:w.getCookie(w.cg).t},{path:"/",expires:99999})),w.visit_date=new Date,c=function(){w.$.ajax({type:"GET",url:w.PUBLIC_SERVER+"backend/widget_data.php",dataType:"json",data:{widget_key:_emv.campaign,h:window.location.host,cache:Math.random(),tz_offset:w.getTz()},success:function(e){w.log("Campaign Loaded from Server",e),void 0===e.widget_key&&w.log("Invalid widget_key");var t=new Date((new Date).getTime()+18e4),o=!(w.W={widget_key:e.widget_key,user_id:e.user_id,active:e.active,active_changed:e.active_changed||!1,night_mode:e.night_mode,catch_on_exit:e.catch_on_exit,catch_by_timer:e.catch_by_timer,catch_by_timer_time:e.catch_by_timer_time,allow_multiple_conversions:e.multiple_conversions,timeout:e.timeout,callback_time:e.callback_time,float_button:e.float_button,mobile_button:e.mobile_button,country:e.country||"ru",lang:e.lang||"ru",position:e.position,chat:e.chat||0,chat_uid:e.chat_uid||0,chat_id:e.chat_id||0,tooltip_scroll:e.tooltip_scroll,tooltip_hover:e.tooltip_hover,suitable_time:e.suitable_time,magic_forms:e.magic_forms,magic_forms_callback:e.magic_forms_callback,magic_forms_night_mode:e.magic_forms_night_mode,facebook_pixel_id:e.facebook_pixel_id||"",facebook_pixel_event:e.facebook_pixel_event||"",status:e.status,block_desc:e.block_desc,hide_call_timer:e.hide_call_timer,faq_settings:e.faq_settings});return w.W.widget_key!=_emv.campaign&&(w.log("is_geo_office = true"),w.storage=null,w.restartStorage(w.W.widget_key),o=!0),e.chat&&e.chat_uid&&e.chat_data&&(e.chat_data.operators&&w.storage.localStorage.set("chat_operators",e.chat_data.operators),e.chat_data.settings&&(w.storage.localStorage.set("chat_settings",e.chat_data.settings),w.chat_settings=e.chat_data.settings,w.W.chat_init="hide")),e.form_settings&&(w.form_settings=e.form_settings,w.storage.localStorage.set("form_settings",e.form_settings)),void 0!==e.url_config&&void 0!==e.url_config.urls&&0<e.url_config.urls.length?w.storage.localStorage.set("url_config",e.url_config):w.storage.localStorage.remove("url_config"),void 0!==e.scheduler&&void 0!==e.scheduler.days&&void 0!==e.scheduler.times?w.storage.localStorage.set("scheduler",e.scheduler):w.storage.localStorage.remove("scheduler"),void 0!==e.departments&&1<e.departments.length?w.storage.localStorage.set("departments",e.departments):w.storage.localStorage.remove("departments"),w.setCookie(w.cc,w.W,{path:"/",expires:t}),o?w.initWidget():w.campaignLoaded(e)},error:function(){},dataType:"jsonp",jsonpCallback:"jsonpCallback"})},w.restarted||(w.$(window).on("beforeunload",function(){w.unloadWidget()}),setInterval(function(){w.stat.t++,w.total_time++,w.stat.a=w.total_time},1e3)),void 0===w.getCookie(w.cg))return b=ldbck.generateUUID(),w.setCookie(w.cg,{guid:b,converted:!1,t:0},{path:"/",expires:99999}),ldbck.log("New GUID Cookie Created"),w.removeCookie(w.cc,{path:"/"},c());if(ldbck.log("Loaded GUID Cookie"),w.total_time=w.getCookie(w.cg).t,void 0!==w.getCookie(w.cg).l&&(w.last_visit_timeout=Math.round(((new Date).getTime()-w.getCookie(w.cg).l)/1e3)),w.log("self.last_visit_timeout="+w.last_visit_timeout),void 0===w.getCookie(w.cc))return c();if(ldbck.log("Campaign Loaded from Cookie"),b=w.getCookie(w.cc),b.chat&&b.chat_uid&&!0===w.storage.localStorage.isEmpty("chat_operators"))return w.log("force LOAD Campaign (empty storage)"),c();w.W=b;try{clearInterval(w.countDownInterval)}catch(e){}return w.campaignLoaded(b)},w.unloadWidget=function(){if(void 0!==w.getCookie(w.cg)&&(w.setCookie(w.cg,{guid:w.getCookie(w.cg).guid,converted:w.getCookie(w.cg).converted,t:w.total_time,l:(new Date).getTime()},{path:"/",expires:99999}),window._emv))try{delete window.ldbck_loaded}catch(e){}},w.campaignLoaded=function(e){if(w.log("compaignLoaded",w.W),"block"==w.W.widget_key)return w.W.block_desc&&console.log("Widget is blocked. Reason: "+w.W.block_desc),!1;if("0"==w.W.status)return w.log("Widget is turn off!");if(!w.W.active&&!w.W.night_mode&&!w.is_vk)return w.log("Not active!");if(!w.storage.localStorage.isEmpty("url_config")){var t=w.storage.localStorage.get("url_config"),o=document.location.href;try{o=decodeURIComponent(document.location.href)}catch(e){w.log(e)}for(var i,n="allow"!=t.rule,a=0,l=t.urls.length;a<l;a++){i=(i=t.urls[a]).replace(/[\-\[\]{}()+!<=:?\.\,\/\\\^$|#\s]/g,"\\$&").replace(/([*])/g,".+"),0!==t.urls[a].indexOf("http:")&&0!==t.urls[a].indexOf("https:")||-1!==t.urls[a].indexOf("*")||(w.log("full url pattern: "+i),i="^"+i+"$");var r=new RegExp(i);if(w.log("CHECK pattern["+t.rule+"]:"+i),r.test(void 0)||r.test(o)){if("allow"==t.rule){w.log("ALLOWED: "+i),n=!0;break}if("deny"==t.rule){w.log("DENIED: "+i),n=!1;break}}}if(!1===n)return w.log("Not allowed by url config")}var s,c;w.W.callback_time&&(w.timer=1e3*w.W.callback_time),s=w.getCookie(w.cg).converted,c=w.W.allow_multiple_conversions,w.is_vk?w.insertWidget(w.W,!0):("1"==w.W.chat&&w.W.chat_id&&w.W.chat_uid&&"undefined"==typeof Cloudim&&(w.log("Chat IS ON",w.W.chat_id),w.loadScript(w.CHAT_CDN+"chat.js?v2.2",!0,function(){w.log("Chat IS loaded"),Cloudim.Options.Chat.silent=!0,w.DEBUG&&(Cloudim.Options.debug=!0);var e,t="rand";w.storage.localStorage.isEmpty("chat_settings")||void 0!==(e=w.storage.localStorage.get("chat_settings")).operators_queue&&(t=e.operators_queue),"all"!=t&&4543!=w.W.user_id||(w.ACCEPT_CHATS=!0,Cloudim.Options.accept_chats=!0),Cloudim.Api.bind("onInit",function(e){w.log("Chat EVENT onInit");var i=!1;"#demomode"==window.location.hash&&(w.log("Demo CHAT mode ON"),window.location.hash="#demomode-chat",Cloudim.Api.clearCache(),i=!0),w.Chat.widget_key||w.loadScript(w.JS_CDN+"leadback-chat-api.js?v="+w.version,!0,function(){w.log("LOADED leadback-chat-api.js",w.version);var o=setInterval(function(){var e,t;!0===w.dom_is_ready?(clearInterval(o),w.Chat=_LBCHATAPI.init(w,w.W),w.Events._callEvent("onChatReady",w.Chat.Api),i?(w.log("CHAT IS Clear"),w.Chat.removeAllChatState(),window.location.reload()):(e=[],w.storage.localStorage.isEmpty("user_info")||(t=w.storage.localStorage.get("user_info"),e.push({name:"fullName",value:t.name}),e.push({name:"Email",value:t.email}),e.push({name:"Phone",value:t.phone})),0<e.length&&Cloudim.Api.sendUserData(e))):w.log("wait_insert_widget...")},100)})}),Cloudim.Api.bind("onReady",function(){w.log("Chat EVENT onReady"),Cloudim.Api.bind("onOperatorChange",function(e){w.DEBUG&&alert("operatorChanged"),e.operator&&w.Chat.acceptChat(e.operator)}),Cloudim.Api.bind("onExternalEvent",function(e){w.log("Chat EVENT onExternalEvent"),"xmpp.operator.cobrowse.internal.page"==e.event&&w.coBrowseV2()}),w.$("#cloudim_chat").hide();var e=setInterval(function(){w.Chat.widget_key&&(clearInterval(e),w.$(window).bind("hashchange",function(){"#chatopen"==window.location.hash&&(window.location.hash="#chatopen-done",null!==w.Chat.is_online&&(w.Chat.openChat(),w.Chat.scrollChatsToBottom(!0)))}),Cloudim.Api.getCurrentOperator(function(e){if(w.log("check Offline mode",e),w.ACCEPT_CHATS&&1<e.length&&w.Chat.setAcceptChatMode(e),!1===e)if(w.log("Chat EVENT Offline"),w.Chat.getChatSettings("offline_invite"))if(!1!==w.Chat.is_online){w.Chat.setOfflineMode();var t,o=w.storage.localStorage.get("chat_operators"),i=Math.round(Math.random()*(o.length-1));w.storage.localStorage.isEmpty("chat_operator")?w.storage.localStorage.set("chat_operator",i):0<=(t=w.storage.localStorage.get("chat_operator"))&&t<o.length&&(i=t);e=o[i];w.Chat.setOperator(e.operator_name,e.avatar_url),w.Chat.clearChatHistroy();var o=w.Chat.getChatInviteState(),i=w.Chat.getChatSettings("offline_invite_goal"),n=[];n[0]=w.Chat.getChatSettings("offline_invite_greeting"),void 0===i||"bot"==i||"bot_contacts"==i?(n[1]=w.Chat.getChatSettings("offline_invite_offer"),n[2]=w.Chat.getChatSettings("offline_invite_action"),w.$("#lb_widget-root .lb-widget-layout-balloon .lb-balloon .lb-balloon__wrapper-form.js-trigger-chat").show()):(n[1]=w.Chat.getChatSettings("offline_invite_offer_2"),n[2]=w.Chat.getChatSettings("offline_invite_action_2"),w.$("#lb_widget-root .lb-widget-layout-balloon .lb-balloon .lb-balloon__wrapper-form.js-trigger-chat").hide());e=[];if(e[0]=w.Chat.getChatSettings("offline_invite_call_offer"),e[1]=w.Chat.getChatSettings("offline_invite_call_action"),w.log("invite_goal",i),w.log("invite state",o),o.called||o.converted)if(w.log("converted & called"),void 0===i||"bot"==i||"bot_contacts"==i){w.log("Invite goal "+i+" toggle button"),w.Chat.toggleOperatorButton(),w.Chat.inviteVisitorInChat(n,!0,!0);var a=w.Chat.readLocalMessages();if(a&&a.length)for(var l=0,r=a.length;l<r;l++)w.Chat.addMessageInChat(a[l],"visitor",new Date,!0);w.Chat.inviteVisitorInCall(e,!0)}else"call"===i&&(w.log("Invite goal call toggle button"),w.Chat.toggleOperatorButton());else o.readed||o.invited?(w.log("invited & readed"),w.Chat.removeLocalMessages(),w.Chat.toggleOperatorButton(),w.Chat.inviteVisitorInChat(n,!0,o.readed)):(w.log("NOT invited"),w.Chat.removeLocalMessages(),o=w.Chat.getChatSettings("offline_invite_delay"),w.log("getChatSettings -> offline_invite_delay",o),setTimeout(function(){w.log("RUN OFFLINE INVITE"),w.Chat.toggleOperatorButton(),w.Chat.inviteVisitorInChat(n),w.Chat.saveChatInviteState(!0,!1,!1,!1)},1e3*o))}else w.log("Chat now in offline -> exit");else w.log("Chat offline_invite IS OFF");else w.Chat.showChatButton()}))},100)}),Cloudim.Api.bind("onShowTab",function(e){w.log("Chat EVENT onShowTab")}),Cloudim.Api.bind("onClose",function(){w.log("Chat EVENT onClose")}),Cloudim.Api.bind("onOpen",function(){w.log("Chat EVENT onOpen")}),Cloudim.Api.bind("onMessage",function(e){w.log("Chat EVENT onMessage"),clearTimeout(w.Chat.operator_answer_timeout),clearTimeout(w.Chat.operator_wait_timeout),w.Chat.stopAnswerSimulation(),w.Chat.addMessageInChat(e.message,"operator",null,null,e.silent),void 0!==e.data&&"string"==typeof e.data.cobrowsing&&w.Chat.startCoBrowsing(e.data.cobrowsing,"Оператор",e.message),w.Chat.clearFaqMessages(),w.Chat.saveIsLiveChat(),w.Chat.chatIsOpen()||(w.Chat.addOperatorMessageInBaloon(e.message,!w.Chat.isLayoutBalloonVisible()),w.Chat.isLayoutBalloonVisible()||w.Chat.showLayoutBalloon(!1),w.Chat.increaseBadge(),e=w.Chat.getChatState(),w.Chat.saveChatState(e.open,+e.unread+1))}),Cloudim.Api.bind("onClientMessage",function(e){w.log("Chat EVENT onClientMessage"),w.Chat.addMessageInChat(e.message,"visitor",null,null,!0)}),Cloudim.Api.bind("onTyping",function(e){w.log("Chat EVENT onTyping"),clearTimeout(w.Chat.operator_answer_timeout),clearTimeout(w.Chat.operator_wait_timeout),!0===e.typing?w.Chat.operatorWriting():!1===e.typing&&w.Chat.operatorNotWriting()}),Cloudim.Api.bind("onOnline",function(){w.log("Chat EVENT onOnline");var e=setInterval(function(){w.Chat.widget_key&&(clearInterval(e),null===w.Chat.initial_status?(w.Chat.showChatButton(),Cloudim.Api.getVisitor(function(e){e.chatted&&w.Chat.toggleOperatorButton();var t=w.Chat.getChatState();if(0<t.unread)for(var o=0;o<t.unread;o++)w.Chat.increaseBadge();w.Chat.clearChatHistroy(),w.Chat.loadHistory(e.history),e.jid&&w.Chat.setVisitorJid(e.jid),(t.open&&!w.isMobile()||"#chatopen"==window.location.hash)&&(w.Chat.openChat(),w.Chat.scrollChatsToBottom(!0),"#chatopen"==window.location.hash&&(window.location.hash="#chatopen-done"))}),Cloudim.Api.getCurrentOperator(function(e){var t,o,i,n,a;w.log("getCurrentOperator",e),w.ACCEPT_CHATS&&1<e.length&&w.Chat.setAcceptChatMode(e),e?(w.Chat.setOnlineMode(),n=w.Chat.getChatInviteState(),w.log("invite_state",n),t=w.Chat.getChatSettings("chat_invite"),w.log("getChatSettings -> chat_invite",t),o=w.Chat.isChattedVisit(),w.log("isChattedVisit -> is_chatted_visit",o),w.Chat.initFaq(),t&&!o&&((i=[])[0]=w.Chat.getChatSettings("chat_invite_greeting"),i[1]=w.Chat.getChatSettings("chat_invite_offer"),i[2]=w.Chat.getChatSettings("chat_invite_action"),w.log("getChatSettings -> invite messages",i),n.invited?n.invited&&!n.readed?(w.Chat.toggleOperatorButton(),w.Chat.inviteVisitorInChat(i,!0)):n.invited&&n.readed&&!n.converted&&(w.Chat.toggleOperatorButton(),w.Chat.inviteVisitorInChat(i,!0,!0)):(a=w.Chat.getChatSettings("invite_delay"),w.log("getChatSettings -> invite_delay",a),clearTimeout(w.Chat.invite_timeout),w.Chat.invite_timeout=setTimeout(function(){w.log("RUN INVITE"),w.Chat.toggleOperatorButton(),w.Chat.inviteVisitorInChat(i),w.Chat.saveChatInviteState(!0,!1,!1,!1)},1e3*a))),n=w.storage.localStorage.get("chat_operators"),(a=w.Chat.getCurrentOperator(e,n))?w.Chat.setOperator(a.operator_name,a.avatar_url):0<n.length&&0<e.length&&(n=w.Chat.getOnlineWidgetOperators(n,e)).length?w.Chat.setOperator(n[0].operator_name,n[0].avatar_url):w.Chat.setOperator("Оператор","/images/portraits/2.jpg")):w.log("Chat EVENT Offline")}),w.Chat.Events._callEvent("onOnline")):w.log("IGNORE Chat EVENT onOnline"))},100)}),w.DEBUG?(w.log("Chat DEBUG is ON"),Cloudim.Chat.init({uid:20621})):Cloudim.Chat.init({uid:w.W.chat_uid,group:w.W.chat_id})})),w.loadScript(w.JS_CDN+"_assets.min.js?v="+w.version,!0,function(){if(w.W.float_button&&w.log("float_button IS ON"),w.isMobile())w.W.mobile_button?w.insertWidget(w.W):w.log("mobile_button IS OFF");else if(w.$(window).on("hashchange",function(){"#callback"==window.location.hash&&(w.insertWidget(w.W,!0),window.location.hash="#callback-showed")}),"#leadback"==window.location.hash)setTimeout(function(){w.insertWidget(w.W,!0)},3e3);else{if(!s||c||w.W.float_button)return w.insertWidget(e);w.log("Already Converted!")}})),w.sendEvent("pageview")},w.insertWidget=function(e,f){if(!0===w.dom_is_ready)return w.log("Widget has be inserted"),void(f&&w.showWidget(w.$("#lb_widget-root")));w.log("insertWidget");var t=window.location.host,t=encodeURI(w.PUBLIC_SERVER+"backend/widget_widget.php?h="+t+"&widget_key="+w.W.widget_key+"&v="+w.version);w.is_vk?w.DEBUG||(t+="&vk_api="+encodeURIComponent(document.location.href)):(w.isMobile()?(t+="&mobile",t+="&chat="+w.W.chat):(t+="&chat="+w.W.chat,w.log("self.W.chat_init",w.W.chat_init)),"1"==w.W.chat&&w.W.chat_init&&(t+="&chat_init="+w.W.chat_init)),w.log("url",t),w.$.ajax({type:"GET",async:!0,cache:!0,url:t,error:function(e,t,o){return w.log(o),w.log("Main HTML Failed to Load")},success:function(e){var t="";t=""==w.W.position?"bottom: 50px; right: 50px":w.W.position;var n=w.$("<div id='lb_widget-root'><div id='lb_widget-wrapper' style='display:none;'></div><div id='lb_eula_widget-wrapper' style='display:none;'></div><div id='lb_button-wrapper' style='position: fixed; "+t+" ; z-index: 10000000000;'></div></div>");if(n.find("#lb_widget-wrapper").html(e.html).hide(),n.find("#lb_eula_widget-wrapper").html(e.eula).hide(),n.find("#lb_widget-wrapper .lb_callback_time").text(w.W.callback_time||27),!w.storage.localStorage.isEmpty("scheduler")&&(!w.W.active&&w.W.night_mode&&(void 0===w.W.suitable_time||"nigth"==w.W.suitable_time)||void 0!==w.W.suitable_time&&"always"==w.W.suitable_time)){var a=w.storage.localStorage.get("scheduler");if("object"==typeof a&&0<a.days.length){n.on("click","#lb_widget-scheduler--link",function(e){e.preventDefault(),n.find("#lb_widget-scheduler").show(),n.find("#lb_widget-invite").hide(),n.find("#lb_timer").hide(),n.find("#lb_widget-scheduler--controls").hide(),n.find("#lb_widget-scheduler").data("opened",!0)}),n.on("change","#lb_widget-scheduler--days",function(e){var t=w.$("option:selected",this).data();if(null!==t){n.find("#lb_widget-scheduler--times").empty();for(var o=0,i=a.times[t.index].length;o<i;o++)n.find("#lb_widget-scheduler--times").append('<option value="'+w.escapeHtml(a.times[t.index][o].value)+'">'+w.escapeHtml(a.times[t.index][o].label)+"</option>")}});for(var o=0,i=a.days.length;o<i;o++)n.find("#lb_widget-scheduler--days").append('<option value="'+w.escapeHtml(a.days[o].value)+'" data-index="'+o+'">'+w.escapeHtml(a.days[o].label)+"</option>");n.find("#lb_widget-scheduler--days").trigger("change"),n.find("#lb_widget-scheduler--controls").show(),w.W.active||"use_holidays"!==w.W.active_changed||n.find("#lb_widget-scheduler--link").click()}}if(!w.storage.localStorage.isEmpty("departments"))for(var l=w.storage.localStorage.get("departments"),o=0,i=l.length;o<i;o++)n.find("#lb_widget-department--items").append('<label class="lb_widget-radio"><input type="radio" name="lb_widget-department--value" data-index="'+o+'" value="'+w.escapeHtml(l[o])+'" '+(0==o?'checked="checked"':"")+"/>&nbsp;"+w.escapeHtml(l[o])+"</label>");if(w.parseWidgetText(n),w.isMobile()){w.$multibutton=n.find("ldiv.lb-widget"),w.is_multibutton=!!w.$multibutton.length,n.find("#lb_exit").on("click",function(){w.hideWidget(n)});var r,s=n.find("#lb_mobile-call"),c=n.find(".lb_mobile-wrapper");if(w.$("body").on("click",'a[href="#callback"]',function(e){w.showWidget(n),e.preventDefault()}),w.$("body").on("click","#lb_widget-root a.js-trigger-callback",function(e){w.showWidget(n),e.preventDefault()}),w.$(window).on("hashchange",function(){"#callback"==window.location.hash&&(w.showWidget(n),window.location.hash="#callback-showed")}),"1"==w.W.chat){try{w.$(window).on("ready",function(){var e=w.screen_width/window.innerWidth;n.find(".lb-widget-button").css("zoom",1/e),n.find(".lb-widget-welcome-panel").css("zoom",1/e)})}catch(e){}s.on("click",function(){w.showWidget(n)})}else w.$(window).on("orientationchange load",function(){90==window.orientation||-90==window.orientation?(w.screen_width=Math.max(window.screen.availWidth,window.screen.availHeight),w.screen_height=Math.min(window.screen.availWidth,window.screen.availHeight)):(w.screen_width=Math.min(window.screen.availWidth,window.screen.availHeight),w.screen_height=Math.max(window.screen.availWidth,window.screen.availHeight)),w.mobileButton(s,c)}),w.$(window).on("touchmove",function(){w.mobileButton(s,c)}),w.$(window).on("touchstart",function(){s.css("opacity",0)}),w.$(window).on("touchend",function(){s.css("opacity",1),w.mobileButton(s,c)}),w.$(window).on("scroll",function(){s.css("opacity",0),clearTimeout(r),r=setTimeout(function(){s.css("opacity",1),w.mobileButton(s,c)},300)}),w.mobileButton(s,c),w.is_multibutton?(n.on("click","#lb_widget-wrapper .lb-widget-button",function(e){w.$multibutton.toggleClass("lb-widget--open-dialog")}),n.on("click","#lb_widget-wrapper .lb-action-link--discard",function(e){e.preventDefault(),w.$multibutton.toggleClass("lb-widget--open-dialog")}),n.on("click","#lb_widget-wrapper .lb-widget > .lb-overlay",function(e){e.preventDefault(),w.$multibutton.toggleClass("lb-widget--open-dialog")}),w.startMultiButtonSlides()):s.find(".lb-click_area").on("click",function(){w.showWidget(n)});c.find("input.lb_input").on("focus",function(){c.find(".lb_title-desc").hide(),c.find(".lb_form-label").show()}),!w.is_multibutton||(t=n.find("#lb-multibutton-style-os")).length&&(w.isIOS()?t.attr("href",w.PUBLIC_SERVER+"/css/multibutton/style-ios.min.css?"+w.version):t.attr("href",w.PUBLIC_SERVER+"/css/multibutton/style-android.min.css?"+w.version),t.on("load",function(){setTimeout(function(){w.$multibutton.show(),w.$multibutton.find(".lb-overlay").attr("style",""),w.$multibutton.find(".lb-dialog").attr("style","")},50)}))}else{if(w.$('a[href="#callback"]').on("click",function(e){w.showWidget(n),e.preventDefault()}),w.W.float_button&&e.button){n.find("#lb_button-wrapper").html(e.button),"1"==w.W.chat&&n.find(".phone-call_wave").removeClass("phone-call_wave__stroke");var d=n.find(".lb_button_tooltip--container .lb_button_tooltip--text").html(),d=w.parseMacros(d);if(d=w.parseInlineTemplates(d),d=w.parseCountDownMacros(d),n.find(".lb_button_tooltip--container .lb_button_tooltip--text").html(d),n.find("#lb_button-call").hasClass("lb_fixed-button"))n.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",function(){w.showWidget(n),n.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(n.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),w.storage.localStorage.set("tooltip_closed",!0))});else if("0"!=w.W.chat||w.isTouch())n.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",function(){w.showWidget(n),n.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(n.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),w.storage.localStorage.set("tooltip_closed",!0))});else{n.find("#lb_button-wrapper").attr("title","Нажмите, чтобы заказать обратный звонок или перетащите, если кнопка мешает навигации.");try{w.$(n.find("#lb_button-call")[0]).draggableTouch().on("dragstart",function(e,t){this.ignoreClick=!1,t&&(this.startPosition=t)}).on("dragend",function(e,t){t&&(this.startPosition.top-t.top==0||this.startPosition.left-t.left==0||(this.ignoreClick=!0))}),n.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",function(){n.find("#lb_button-call")[0].ignoreClick||(w.showWidget(n),n.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(n.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),w.storage.localStorage.set("tooltip_closed",!0)))})}catch(e){n.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",function(){w.showWidget(n),n.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(n.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),w.storage.localStorage.set("tooltip_closed",!0))})}}var u,g=null,h=(w.$(document).innerHeight()-w.$(window).height())/w.$(window).height();"0"==w.W.chat&&.5<h?(n.find("#lb_button-wrapper").show(),n.find("#lb_button-wrapper .lb_call-btn").addClass("bigEntrance"),w.$(document).on("scroll",function(){if(w.widgetIsShow(n))return!0;var e=w.$(document).scrollTop()/(w.$(document).innerHeight()-w.$(window).height());n.find("#lb_button-wrapper .lb_call-btn").css("opacity",1),clearInterval(g),g=setInterval(function(){e<=.3&&n.find("#lb_button-wrapper .lb_call-btn").css("opacity",.7),clearInterval(g)},500),(150<w.$(document).scrollTop()||.3<e)&&(clearInterval(null),n.find("#lb_button-wrapper").show(),n.find("#lb_button-wrapper .lb_call-btn").addClass("bigEntrance"),300<w.$(document).scrollTop()&&.4<e&&n.find("#lb_button-wrapper .lb_call-btn").addClass("lb-pulse"))})):(n.find("#lb_button-wrapper").show(),n.find("#lb_button-wrapper .lb_call-btn").addClass("bigEntrance"),"0"==w.W.chat?n.find("#lb_button-wrapper .lb_call-btn").addClass("lb-pulse"):n.find("#lb_button-wrapper .lb_call-btn").css("opacity",1)),w.W.tooltip_scroll&&(u=null,w.$(document).on("scroll",function(){clearInterval(u),.5<=w.$(document).scrollTop()/(w.$(document).innerHeight()-w.$(window).height())&&(u=setTimeout(function(){w.storage.localStorage.isEmpty("tooltip_closed")||!1===w.storage.localStorage.get("tooltip_closed")?void 0===n.find("#lb_button-call:hover")[0]&&n.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--hide")&&(n.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--hide").addClass("lb_button_tooltip--show"),setTimeout(function(){n.find("#lb_button-wrapper .lb_button_tooltip").addClass("lb_button_tooltip--alert")},3e3)):w.log("tooltip_closed"),clearTimeout(u)},500))})),w.W.tooltip_hover&&n.find("#lb_button-wrapper .lb_button_tooltip").addClass("lb_button_tooltip--hover"),n.find("#lb_button-wrapper .lb_button_tooltip .lb_button_tooltip--close").on("click",function(e){n.find("#lb_button-wrapper .lb_button_tooltip--container").remove(),w.storage.localStorage.set("tooltip_closed",!0)})}n.find("#lb_exit").on("click",function(){w.hideWidget(n)}),document.addEventListener("keydown",function(e){"Escape"===e.key&&(w.log("Escape key detected"),w.hideWidget(n))})}n.on("click",".lb_eula--link",function(e){e.preventDefault(),e.stopPropagation(),w.showEula(w.$(this).attr("href"))}),n.on("click","#lb_eula_widget-wrapper",function(){w.hideEula()});var m=w.getPhonePrefix();n.on("focus","#lb_phone",function(){var e=w.$(this);""==e.val()&&e.val(m),e.val()==m&&setTimeout(function(){e.get(0).selectionStart=e.get(0).selectionEnd=100},10)}).on("change","#lb_phone",function(){var e=w.$(this).val().replace(/[^\d\+]+/g,"");w.$(this).val(e),!1!==(e=w.checkPhone(e))&&w.$(this).val(e)}).on("keypress","#lb_phone",function(e){var t=w.$(this).val().replace(/[^\d\+]+/g,"");"+789"===t.substr(0,4)&&w.$(this).val("+7"+t.substr(3)),13==e.which&&(n.find("#lb_send").trigger("click"),e.preventDefault())}).on("paste","#lb_phone",function(e){return e.preventDefault(),!1}).on("drop","#lb_phone",function(e){return e.preventDefault(),!1}).attr("placeholder",m),n.on("click","#lb_send",function(){var e;!w.storage.localStorage.isEmpty("departments")?(e=n.find("#lb_phone").val(),!1!==(e=w.checkPhone(e))?(n.find("#lb_phone").removeClass("lb_error"),n.find("#lb_widget-invite").hide(),n.find("#lb_widget-scheduler").hide(),n.find("#lb_widget-form").hide(),n.find("#lb_widget-scheduler--controls").hide(),n.find("#lb_widget-department").show(),n.find("#lb_send--department").on("click",function(){w.callTo(n)})):n.find("#lb_phone").addClass("lb_error")):w.callTo(n)}),!w.W.active&&w.W.night_mode&&(n.find("#lb_timer").hide(),n.find(".lb_h6").css("visibility","hidden")),w.$("body").append(n),w.isMobile()&&n.find("#lb_widget-wrapper").show(),w.dom_is_ready=!0;var _,d=w.getCookie("__leadback_need_call");d?(w.log("Run magic_form"),w.removeCookie("__leadback_need_call",{path:"/"}),w.$("#lb_phone").val(d.phone),d.form_type&&-1!==["magic_form","manual_form"].indexOf(d.form_type)||(d.form_type="magic_form"),h={},"magic_form"===d.form_type?h.initiator="magic_forms":"manual_form"===d.form_type&&(h.initiator="manual_forms"),void 0!==w.W.magic_forms_callback&&"show"===w.W.magic_forms_callback&&w.showWidget(n),void 0!==d.label&&(h.label=d.label),w.callTo(n,h)):(f?w.showWidget(n):void 0!==w.W.catch_on_exit&&!w.W.catch_on_exit||w.startCursometer(n),void 0!==w.W.catch_by_timer&&w.W.catch_by_timer&&(_=1e3*w.W.catch_by_timer_time,void 0===w.getCookie(w.ct)?setTimeout(function(){w.log("Time show after: "+_),w.showWidget(n),w.setCookie(w.ct,{campaign:w.W.widget_key,user_id:w.W.user_id},{path:"/",expires:new Date((new Date).getTime()+6e4*w.W.timeout)})},_):w.log("Time show timeout"))),"function"==typeof window.muse_init&&w.$("body").addClass("initialized")},dataType:"jsonp",jsonpCallback:"jsonpWidgetCallback"}),void 0!==w.W.magic_forms&&(t=!1,!w.W.active&&w.W.night_mode&&"off"===w.W.magic_forms_night_mode&&(t=!0),"none"!==w.W.magic_forms&&!1===t&&(w.setupForms(),"undefined"!=typeof MutationObserver&&(w.leadbackObserver=new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.forEach(function(e){var t;e.tagName&&"FORM"===e.tagName?(w.log("Mutation observer added form",e),w.setupForms()):e.tagName&&e.children&&(t=e.querySelectorAll("form"),w.log("Searching forms in added node",e,"inner forms length",t?t.length:0),t&&t.length&&w.setupForms())})})}),w.leadbackObserver.observe(document.documentElement||document.body,{subtree:!0,childList:!0}))))},w.setupForms=function(){if("manual"===w.W.magic_forms){if(w.form_settings=w.storage.localStorage.get("form_settings"),!1!==w.form_settings&&w.form_settings.forms&&w.form_settings.forms.length){w.log("###########"),w.log("FORM SETTINGS RECEIVED AND ACTIVE",w.form_settings);for(var e=[],t=w.form_settings.use_custom_selector&&Number(w.form_settings.use_custom_selector),o=0;o<w.form_settings.forms.length;o++)e.push({selector:w.form_settings.forms[o].selector,data:w.form_settings.forms[o]});for(t&&e.push({selector:"form.lb-magic-form",data:null}),w.log(">>> Form selectors getted",e),w.log(">>> Magic forms are: "+t),w.log("###########"),o=0;o<e.length;o++){var i=w.$(e[o].selector+":not([data-ldbck-form-init])");if(i&&i.length)for(var n=0;n<i.length;n++){var a,l=w.$(i[n]);w.log(">>> Form with selector",e[o].selector,"FOUND. Full class list: ",l.attr("class")),l.attr("data-ldbck-form-init",1),l.data("form-data",e[o].data),"#debug"===document.location.hash&&l.attr("style","border: 1px solid red !important"),e[o].data?(w.log(">>> Form with selector",e[o].selector,"has selector custom data",e[o].data),"onSubmit"===l.data("form-data").event?(w.log(">>> Binding form onSubmit"),l.on("submit",function(){w.log(">>> Manual form onSubmit");var e=w.getManualFormPhone(this);e&&(Number(this.data("form-data").has_redirect)?(w.log(">>> Manual form has redirect, setting cookie"),w.setNeedCallCookie(e,this.data("form-data").name,"manual_form")):(w.log(">>> Manual form has no redirect, calling from widget"),w.$("#lb_phone").val(e),e={initiator:"manual_forms"},void 0!==w.W.magic_forms_callback&&"show"===w.W.magic_forms_callback&&w.showWidget(w.$("#lb_widget-root")),e.label=this.data("form-data").name,w.callTo(w.$("#lb_widget-root"),e)))}.bind(l))):(w.log(">>> Binding form manual onClick"),l.data("form-data").button_selector&&(w.log(">>> manual form onClick selector: ",l.data("form-data").button_selector),(a=w.getFormChildBySelector(l,l.data("form-data").button_selector))&&a.length?(w.log(">>> Manual form onClick has button",a),a.on("click",function(){var e=w.getManualFormPhone(this);e&&(Number(this.data("form-data").has_redirect)?(w.log(">>> Manual form onClick has redirect setting cookie"),w.setNeedCallCookie(e,this.data("form-data").name,"manual_form")):(w.log(">>> Manual form has no redirect, calling from widget"),w.$("#lb_phone").val(e),e={initiator:"manual_forms"},void 0!==w.W.magic_forms_callback&&"show"===w.W.magic_forms_callback&&w.showWidget(w.$("#lb_widget-root")),e.label=this.data("form-data").name,w.callTo(w.$("#lb_widget-root"),e)))}.bind(l))):w.log(">>> Button by selector "+l.data("form-data").button_selector+" NOT FOUND !!!")))):(w.log(">>> MAGIC FORM DETECTED!!! Making submit event"),l.attr("data-ldbck-form-init",1),l.on("submit",function(){var e=w.getPhoneByInputSelector("input",this);e&&w.setNeedCallCookie(e,w.$(this).data("magic-form-label"),"magic_form")})),w.log("###########")}}}}else{t="";"custom"===w.W.magic_forms&&(t=".lb-magic-form"),w.log(">>> Automatic magic forms section: "+t);for(var r=w.$("form"+t+":not([data-ldbck-form-init])"),s=0;s<r.length;s++){var c=w.$(r[s]);c.attr("data-ldbck-form-init",1),c.on("submit",function(){var e=w.getPhoneByInputSelector("input",this);e&&w.setNeedCallCookie(e,w.$(this).data("magic-form-label"),"magic_form")})}}},w.getFormChildBySelector=function(e,t){var o=e.find(t);if(w.log(">>> Searching child inside form",t),o&&o.length)return w.log(">>> Found child inside form",t),o;if(w.log(">>> Form child with selector (",t,") not found, searching global"),(o=w.$.find(t))&&o.length){w.log(">>> Children ("+o.length+") with selector (",t,") found global! Trying to search in child form...",o);for(var i=0;i<o.length;i++){var n=e.find(o[i]);if(n&&n.length)return w.log(">>> Child with selector (",t,") found in form!"),n}}return w.log(">>> Child with selector (",t,") not found in form!"),null},w.getManualFormPhone=function(e){var t,o,i=null;return e.data("form-data").fields&&e.data("form-data").fields.length&&((t=e.data("form-data").fields.filter(function(e){return"phone"===e.type&&""!==e.selector.trim()}))&&t.length&&(t=t[0],(o=w.getFormChildBySelector(e,t.selector))&&o.length&&(i=w.checkPhone(o.val()),w.log(">>> Result phone FOUND by settings field selector",t.selector,"with value",i)))),i||(i=w.getPhoneByInputSelector("input",e),w.log(">>> Getting result phone by all inputs",i)),i},w.setNeedCallCookie=function(e,t,o){w.setCookie("__leadback_need_call",{phone:e,label:t,form_type:o},{path:"/",expires:new Date((new Date).getTime()+6e4)})},w.getPhoneByInputSelector=function(e,t){var n=[];w.$(e,t).each(function(e,t){var o,i=0;if(void 0!==w.$(t).attr("type")){if(o=w.$(t).attr("type"),-1===["tel","text"].indexOf(o))return;"tel"===o&&(i+=50)}void 0!==w.$(t).attr("name")&&(o=w.$(t).attr("name"),-1!==["phone","number","callback","tel","telephone"].indexOf(o)&&(i+=50));t=w.checkPhone(t.value);!1!==t&&(n[n.length]={value:t,priority:i})});var o=null;if(0<n.length)for(var i=0,a=n.length;i<a;i++)(null===o||n[i].priority>o.priority)&&(o=n[i]);return o?o.value:null},w.checkPhone=function(e){return("7"!=(e="789"==(e="8"==(e=("495"==(e="9"==(e=e.replace(/[^\d]+/g,"")).substr(0,1)&&10==e.length?"7"+e:e).substr(0,3)||"499"==e.substr(0,3)||"812"==e.substr(0,3)||"4832"==e.substr(0,4))&&10==e.length?"7"+e:e).substr(0,1)&&11==e.length?"7"+e.substr(1):e).substr(0,3)&&12==e.length?"7"+e.substr(2):e).substr(0,1)||11==e.length)&&((11==e.length||12==e.length)&&(e="+"+e))},w.startCursometer=function(t){w.restarted||w.isMobile()?w.log("IGNORE startCursometer"):(w.log("startCursometer"),w.$(window).cursometer({onUpdateSpeed:function(e,t){if(null!==e)return w.LAST_SPEED=t},updateSpeedRate:15}),w.$("html").mouseout(function(e){e=e||window.event,w.LAST_X_POSITION=e.clientX,w.LAST_Y_POSITION=e.clientY,0<w.LAST_Y_POSITION||w.LAST_X_POSITION<200||(w.total_time>=w.activity?(e=void 0===w.getCookie(w.cg)||!w.getCookie(w.cg).converted||w.W.allow_multiple_conversions,.225<w.LAST_SPEED&&e&&void 0===w.getCookie(w.ct)&&w.last_visit_timeout<300?(w.stat.x=w.LAST_X_POSITION,w.stat.y=w.LAST_Y_POSITION,w.stat.s=w.LAST_SPEED,w.showWidget(t),w.setCookie(w.ct,{campaign:w.W.widget_key,user_id:w.W.user_id},{path:"/",expires:new Date((new Date).getTime()+6e4*w.W.timeout)}),w.log("Set timeout "+w.W.timeout)):w.log("Impression timeout",w.last_visit_timeout,void 0===w.getCookie(w.ct))):w.log("activity",w.activity,w.total_time,w.last_visit_timeout))}))},w.showWidget=function(e){w.log("showWidget"),w.widgetIsShow(e)?w.log("IS now shoed"):("function"==typeof w.beforeOpenWidget&&w.beforeOpenWidget(),w.runCountDownTimers(),w.sendEvent("impression"),w.sendGoal("LEADBACK_OPEN"),e.show(),w.isMobile()?(e.find(".lb_mobile-wrapper").show(),w.mobileAdoptation()):(e.find("#lb_widget-wrapper").show(),e.find("#lb_phone").focus()),w.W.float_button&&e.find("#lb_button-wrapper").hide()),void 0!==w.W.hide_call_timer&&w.W.hide_call_timer&&e.find("#lb_timer").hide()},w.hideWidget=function(e){e.find("#lb_widget-scheduler").is(":visible")&&(e.find("#lb_widget-scheduler").hide(),e.find("#lb_widget-scheduler").data("opened",!1),e.find("#lb_widget-invite").show(),w.W.active&&e.find("#lb_timer").show(),e.find("#lb_widget-scheduler--controls").show()),w.isMobile()?(w.sendGoal("LEADBACK_CLOSE"),e.find(".lb_mobile-wrapper").hide(),w.mobileAdoptation()):(w.sendGoal("LEADBACK_CLOSE"),e.find("#lb_widget-wrapper").hide(),w.W.float_button&&e.find("#lb_button-wrapper").show())},w.startMultiButtonSlides=function(){return!!w.is_multibutton&&setInterval(function(){var o,i,e;w.dom_is_ready&&(o=null,w.$("#lb_widget-root .lb-button__slides .lb-button-slides__item").not(".lb-widget-panel__item--hide").each(function(e,t){w.$(t).hasClass("lb-button-slides__item--active")?(o=e,w.$(t).removeClass("lb-button-slides__item--active"),(i=w.$(t).data("slide-action"))&&w.$(t).closest(".lb-button-flipper__front").removeClass("lb-button-flipper__front--"+i)):null!==o&&(w.$(t).addClass("lb-button-slides__item--active"),o=null,(i=w.$(t).data("slide-action"))&&w.$(t).closest(".lb-button-flipper__front").addClass("lb-button-flipper__front--"+i))}),null!==o&&((e=w.$("#lb_widget-root .lb-button__slides .lb-button-slides__item:first-child").not(".lb-widget-panel__item--hide")).addClass("lb-button-slides__item--active"),(i=e.data("slide-action"))&&e.closest(".lb-button-flipper__front").addClass("lb-button-flipper__front--"+i)))},1e4)},w.getUrlParameter=function(e){var t=location.search;e=e.replace(/[\-\[\]{}()+!<=:?\.\,\/\\\^$|#\s]/g,"\\$&");e=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t),t="";return e&&0<e.length&&(t=e[1].replace(/\+/g," "),t=decodeURIComponent(t),t=(t=w.escapeHtml(t)).replace(/\_/g," ")),null===e?"":t},w.checkCanReplaceMacro=function(e){if("string"!=typeof e)return!1;for(var t=["/images/uploads/chat","https://leadback.ru/ya-money?payment=","https://leadback.ru/chat-payments?payment=","s3upload://","https://leadback.s3.eu-central-1.amazonaws.com/chat_uploads/","https://leadback.s3.eu-central-1.amazonaws.com/uploads/","https://leadback.s3.yandexcloud.net/chat_uploads/"],o=0;o<t.length;o++)if(0===e.indexOf(t[o]))return!1;return!0},w.parseQueryMacros=function(e){if(!w.checkCanReplaceMacro(e))return e;var t,o=e.match(/\[get\:([^\]\|]+)\|?([^\]\|]+)?\]/gm);if(null!==o&&o.length)for(var i=0,n=o.length;i<n;i++){var a,l=o[i].replace(/^\[/,"").replace(/\]$/,"");e=-1<(a=(l=l.substr(l.indexOf(":")+1)).lastIndexOf("|"))?""!==(t=w.getUrlParameter(l.substr(0,a)))?e.replace(o[i],t):e.replace(o[i],l.substr(a+1)):(t=w.getUrlParameter(l),e.replace(o[i],t))}return e},w.parseTimeMacros=function(e){if(!w.checkCanReplaceMacro(e))return e;for(var t,o=[],i=e.match(/\[(time)(\+|\-)?(\d+)?\]/gim),n=0,a=(o=null!==i?i:o).length;n<a;n++){var l=new Date,r=o[n].replace(/[\[\]]/g,"");e=(-1<r.indexOf("-")?(t=Number(r.split("-")[1]),l.setMinutes(l.getMinutes()-t)):-1<r.indexOf("+")&&(t=Number(r.split("+")[1]),l.setMinutes(l.getMinutes()+t)),e.replace(o[n],l.toLocaleTimeString().substr(0,l.toLocaleTimeString().lastIndexOf(":"))))}return e},w.parseMacros=function(e){return w.checkCanReplaceMacro(e)?(e=w.parseNextDayMacro(e),e=w.parseTimeMacros(e),e=w.parseQueryMacros(e)):e},w.parseNextDayMacro=function(e){var t,o;return e=-1<e.indexOf("%nextDay%")||-1<e.indexOf("%nextDay2%")?"object"==typeof(t=w.storage.localStorage.get("scheduler"))&&0<t.days.length&&(o=Date.parse(t.days[0].value))?(o=new Date(o).getDay(),(e=e.replace(/%nextDay%/gi,w.getNextMacroDay(o,!1))).replace(/%nextDay2%/gi,w.getNextMacroDay(o,!0))):(e=e.replace(/%nextDay%/gi,"")).replace(/%nextDay2%/gi,""):e},w.getNextMacroDay=function(e,t){return(t?["в воскресенье","в понедельник","во вторник","в среду","в четверг","в пятница","в субботу"]:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"])[e]},w.getCountDownType=function(e){return!e||e.match(/^([0-9]{2,4})-([0-1][0-9])-([0-3][0-9])\s?(?:([0-2][0-9]):([0-5][0-9]):([0-5][0-9]))?$/)?"date":e.match(/time\+(\d+d;?)?(\d+h;?)?(\d+m;?)?/)?"time":e.match(/(\d+h;?)?(\d+m;?)?(\d+s;?)?/)?"none":"date"},w.addDays=function(e,t){return e.setTime(e.getTime()+24*t*60*60*1e3),e},w.addHours=function(e,t){return e.setTime(e.getTime()+60*t*60*1e3),e},w.addMinutes=function(e,t){return e.setTime(e.getTime()+60*t*1e3),e},w.addSeconds=function(e,t){return e.setTime(e.getTime()+1e3*t),e},w.parseCountDownMacros=function(e){if(!w.checkCanReplaceMacro(e))return e;for(var t,o=/\[countdown\|([^\]\|]+)\|?([^\]\|]+)?\|?([^\]\|]+)?\|?([^\]\|]+)?]/gi,i=null;null!==(t=o.exec(e));){var n,a,l,r,s,c,i=!0,d="",u="";switch(w.getCountDownType(t[1])){case"date":d=t[1];break;case"time":for(s=t[1].replace("time+","").split(";"),c=0;c<s.length;c++)-1<s[c].indexOf("d")&&(n=s[c].replace("d","")),-1<s[c].indexOf("h")&&(a=s[c].replace("h","")),-1<s[c].indexOf("m")&&(l=s[c].replace("m",""));p=w.visit_date,n&&""!==n&&(p=w.addDays(p,n)),a&&""!==a&&(p=w.addHours(p,a)),l&&""!==l&&(p=w.addMinutes(p,l)),r&&""!==r&&(p=w.addSeconds(p,r));var g=new Intl.DateTimeFormat("ru",{year:"numeric"}).format(p),h=new Intl.DateTimeFormat("ru",{month:"2-digit"}).format(p),m=new Intl.DateTimeFormat("ru",{day:"2-digit"}).format(p),_=Number(new Intl.DateTimeFormat("ru",{hour:"2-digit"}).format(p)),f=Number(new Intl.DateTimeFormat("ru",{minute:"2-digit"}).format(p)),p=Number(new Intl.DateTimeFormat("ru",{second:"numeric"}).format(p)),d=g+"-"+h+"-"+m+" "+(_=_<10?"0"+_.toString():_)+":"+(f=f<10?"0"+f.toString():f)+":"+(p=p<10?"0"+p.toString():p);break;case"none":for(s=t[1].replace("time+","").split(";"),d="",c=u=0;c<s.length;c++)-1<s[c].indexOf("h")&&(a=s[c].replace("h",""),u+=3600*Number(a)),-1<s[c].indexOf("m")&&(l=s[c].replace("m",""),u+=60*Number(l)),-1<s[c].indexOf("s")&&(r=s[c].replace("s",""),u+=Number(r))}e=e.replace(t[0],'<span class="lbwidget-countdown" data-ttl="'+u+'" data-date="'+d+'" data-tpl="'+(t[2]||"")+'" data-expire="'+(t[3]||"")+'" data-format="'+(t[4]||"")+'"></span>')}return e},w.runCountDownTimers=function(){try{clearInterval(w.countDownInterval)}catch(e){}w.replaceTTLDate(),w.setCountDownText(),w.countDownInterval=setInterval(function(){w.setCountDownText()},1e3)},w.replaceTTLDate=function(){for(var e=w.$("span.lbwidget-countdown"),t=0;t<e.length;t++){var o,i,n,a,l,r,s=w.$(e[t]);s.data("ttl")&&""!==s.data("ttl")&&((r=new Date).setTime(r.getTime()+1e3*Number(s.data("ttl"))+1e3),o=new Intl.DateTimeFormat("ru",{year:"numeric"}).format(r),i=new Intl.DateTimeFormat("ru",{month:"2-digit"}).format(r),n=new Intl.DateTimeFormat("ru",{day:"2-digit"}).format(r),a=Number(new Intl.DateTimeFormat("ru",{hour:"2-digit"}).format(r)),l=Number(new Intl.DateTimeFormat("ru",{minute:"2-digit"}).format(r)),r=Number(new Intl.DateTimeFormat("ru",{second:"numeric"}).format(r)),a<10&&(a="0"+a.toString()),l<10&&(l="0"+l.toString()),r<10&&(r="0"+r.toString()),s.data("date",o+"-"+i+"-"+n+" "+a+":"+l+":"+r),s.attr("data-date",o+"-"+i+"-"+n+" "+a+":"+l+":"+r),s.data("ttl",""),s.removeAttr("ttl"))}},w.countdownTimeDeclensions={hour:["час","часа","часов"],minute:["минута","минуты","минут"],second:["секунда","секунды","секунд"]},w.declension=function(e,t,o,i,n){t=null==t?"":t,o=null==o?"я":o,i=null==i?"и":i,n=null==n?"й":n;var a=(e=null==e?0:e)%100,l="";if(10<=e&&e<=20||10<=a&&a<=20)l=n;else switch(e%10){case 1:l=o;break;case 2:case 3:case 4:l=i;break;default:l=n}return t+l},w.prepareCountDownText=function(e,t,o,i){if(e.data("date")&&""!==e.data("date")&&(n=Date.parse(e.data("date"))),isNaN(n)||!n)return"";4!==(i=(i=i||"дн. ,:,:,").split(",")).length&&(i="дн. ,:,:,".split(","));var n,a,l,r,s=n-(new Date).getTime(),c="";return 0<=s?(a=Math.floor(s/864e5),r=Math.floor(s%864e5/36e5),l=Math.floor(s%36e5/6e4),e=Math.floor(s%6e4/1e3),n=0<a?a+i[0]:"",a=(s=i[1]).replace(/[^а-яё]/gi,""),a=w.$.trim(a.toLowerCase()),-1<(a=w.countdownTimeDeclensions.hour.indexOf(a))&&(s=s.replace(w.countdownTimeDeclensions.hour[a],w.declension(r,"час","","а","ов"))),a=r<10?"0"+r.toString()+s:r.toString()+s,s=(r=i[2]).replace(/[^а-яё]/gi,""),s=w.$.trim(s.toLowerCase()),-1<(s=w.countdownTimeDeclensions.minute.indexOf(s))&&(r=r.replace(w.countdownTimeDeclensions.minute[s],w.declension(l,"минут","а","ы",""))),l=l<10?"0"+l.toString()+r:l.toString()+r,i=(r=i[3]).replace(/[^а-яё]/gi,""),i=w.$.trim(i.toLowerCase()),-1<(i=w.countdownTimeDeclensions.second.indexOf(i))&&(r=r.replace(w.countdownTimeDeclensions.second[i],w.declension(e,"секунд","а","ы",""))),c=n+a+l+(e<10?"0"+e.toString()+r:e.toString()+r),t&&(-1===t.indexOf("%s")&&(t+=" %s"),c=t.replace("%s",c))):o&&(c=o),c},w.setCountDownText=function(){var e=w.$("span.lbwidget-countdown");if(0===e.length)return clearInterval(w.countDownInterval),!1;for(var t=0;t<e.length;t++){var o=w.$(e[t]),i=""!==o.data("tpl")?o.data("tpl"):null,n=""!==o.data("expire")?o.data("expire"):null,a=""!==o.data("format")?o.data("format"):null,a=w.prepareCountDownText(o,i,n,a);o.html(a)}},w.parseWidgetText=function(e){for(var t=e.find(".lb-parse-text"),o=0;o<t.length;o++){var i=w.$(t[o]),n=i.html();"string"==typeof n&&(i.hasClass("lb-parse-inline")&&(n=w.parseInlineTemplates(n)),n=w.parseMacros(n),n=w.parseCountDownMacros(n),i.html(n))}},w.getReplacedTags=function(){return w.replacedTags},w.parseInlineTemplates=function(e){if(!w.checkCanReplaceMacro(e))return e;var t=[],o=e.match(/\[\#([^\#\|\]]+)\]/gm);null!==o&&(t=o);for(var i=0,n=(t=null!==(o=e.match(/\[\#([^\#\|\]]+)\|([^\]]+)\]/gm))?t.concat(o):t).length;i<n;i++){var a=[],a=0<t[i].indexOf("|")?t[i].replace(/[\[\]]/g,"").split("|"):[t[i].replace(/[\[\]]/g,""),""],l=w.$(a[0]);0<l.length&&""!=w.$.trim(l.text())?(e=e.replace(t[i],l.text()),w.replacedTags[a[0].replace("#","")]=l.text()):(e=e.replace(t[i],a[1]),w.replacedTags[a[0].replace("#","")]=a[1])}return e},w.widgetIsShow=function(e){return(w.isMobile()?e.find(".lb_mobile-wrapper"):e.find("#lb_widget-wrapper")).is(":visible")},w.showEula=function(e){w.$("#lb_eula_widget-wrapper").show(),w.$("#lb_eula--frame").attr("src",e)},w.hideEula=function(){w.$("#lb_eula_widget-wrapper").hide(),w.isMobile()||w.$("#lb_phone").focus()},w.callTo=function(t,o){w.log("callTo"),w.sendEvent("before_call");var e=t.find("#lb_phone").val();if(!1!==(e=w.checkPhone(e))){t.find("#lb_phone").removeClass("lb_error"),w.sendGoal("LEADBACK_CALL",o),void 0!==w.W.hide_call_timer&&w.W.hide_call_timer?t.find(".lb_show_when_calling").hide():(w.startTimer(t),t.find(".lb_show_when_calling").show()),t.find(".lb_hide_when_calling").hide(),t.find("#lb_send").off("click"),t.find("#lb_button_call_success").off("click").on("click",function(){w.stopTimer(t),t.find(".lb_hide_when_call_answered").hide(),t.find(".lb_show_when_call_answered").show()}),t.find("#lb_button_call_success--department").off("click").on("click",function(){w.stopTimer(t),t.find(".lb_hide_when_call_answered").hide(),t.find(".lb_show_when_call_answered").show()}),t.find("#lb_widget-scheduler--controls").hide();var i="";!0===t.find("#lb_widget-scheduler").data("opened")&&(i=t.find("#lb_widget-scheduler--days").val()+" "+t.find("#lb_widget-scheduler--times").val());var n,a,l="",r="",s=!w.storage.localStorage.isEmpty("departments"),c="";return"object"==typeof o&&(void 0!==o.delayed&&(i=/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(o.delayed)?o.delayed:(a=["00","0",""],(n=new Date).setSeconds(n.getSeconds()+parseInt(o.delayed,10)),n.getFullYear()+"-"+(a[new String(n.getMonth()+1).length]+new String(n.getMonth()+1))+"-"+(a[new String(n.getDate()).length]+new String(n.getDate()))+" "+(a[new String(n.getHours()).length]+new String(n.getHours()))+":"+(a[new String(n.getMinutes()).length]+new String(n.getMinutes()))+":"+(a[new String(n.getSeconds()).length]+new String(n.getSeconds()))),w.log("SET delayed_time",i)),void 0!==o.label&&(l=o.label),void 0!==o.initiator&&(r=o.initiator),s&&void 0!==o.department&&(c=o.department)),w.log("Department assigned",c),""===c&&s&&(c=t.find('#lb_widget-department--items input[name="lb_widget-department--value"]:checked').val()),w.$.ajax({type:"GET",async:!0,url:w.PUBLIC_SERVER+"backend/widget_call.php",data:{site:window.location.host,phone:e,widget_key:w.W.widget_key,user_id:w.W.user_id,delayed:i,tz:w.getTz(),guid:w.getCookie(w.cg).guid,calltouch:window.calltouch_phone||window.calltouch_phone_1||window.calltouch_phone_2||"",department:c,label:l,initiator:r,cache:Math.random()},success:function(e){return w.setCookie(w.cg,{guid:w.getCookie(w.cg).guid,converted:!0},{path:"/",expires:99999}),"delayed"==e.result?(w.stopTimer(t),t.find(".lb_widget-container").hide(),t.find(".lb_widget-message").show(),t.find(".lb_delay-date").text(e.time.replace(/^\d{2}(\d{2})\-(\d{2})\-(\d{2}) .+$/,"$3/$2")),t.find(".lb_delay-time").text(e.time.replace(/^.+(\d{2}\:\d{2})\:\d{2}$/,"$1")),t.find("#lb_close").on("click",function(){t.hide(),w.isMobile()&&w.mobileAdoptation()})):w.isMobile()&&"success"==e.result?(t.find(".lb_widget-container").hide(),t.find(".lb_widget-message").show(),t.find(".lb_message_title--delayed").hide(),t.find(".lb_message_title--success").show(),t.find("#lb_close").on("click",function(){t.hide(),w.isMobile()&&w.mobileAdoptation()})):"notice"===e.result&&w.showNotice(t,e),void 0===w.W.hide_call_timer||!w.W.hide_call_timer||"success"!==e.result&&"delayed"!==e.result||w.showNotice(t,e),"success"!=e.result&&"delayed"!=e.result&&"notice"!=e.result||"delayed"===e.result&&e.exists||w.sendEvent("call"),"function"==typeof w.successCallCallback&&(e.params=o,w.successCallCallback(e)),void 0!==w.Chat.widget_key&&void 0!==e.data&&void 0!==e.data.callback_phone&&""!=e.data.callback_phone&&w.Chat.sendEvent("set_profile",{profile:{phone:e.data.callback_phone}}),w.log("Call Success")},error:function(){return w.log("Call Error!")},dataType:"jsonp",jsonpCallback:"jsonpCallCallback"})}t.find("#lb_phone").addClass("lb_error")},w.showNotice=function(e,t){e.find(".lb_widget-container").hide(),e.find(".lb_widget-message").show(),t.time&&""!==t.time?(e.find(".lb_delay-date").text(t.time.replace(/^\d{2}(\d{2})\-(\d{2})\-(\d{2}) .+$/,"$3/$2")),e.find(".lb_delay-time").text(t.time.replace(/^.+(\d{2}\:\d{2})\:\d{2}$/,"$1"))):(e.find(".lb_message_title--delayed").hide(),e.find(".lb_message_title--success").show()),e.find("#lb_close").on("click",function(){e.hide(),w.isMobile()&&w.mobileAdoptation()})},w.startTimer=function(t){w.log("startTimer"),w.interval=setInterval(function(){var e=w.timer-46;e<=0&&(e=0,clearInterval(w.interval)),w.timer=e,w.timerHtml(t)},46)},w.stopTimer=function(e){w.log("stopTimer"),clearInterval(w.interval)},w.timerHtml=function(e){var t=0,o=Math.floor(w.timer/1e3).toString(),t=Math.round((w.timer-1e3*o)/10).toString();o=o.length<2?"0"+o:o,t=t.length<2?"0"+t:2<t.length?"00":t,e.find("#lb_timer_result").text("0:"+o+","+t)},w.sendEvent=function(e,t){return w.log("sendEvent",e,t),w.$.ajax({type:"GET",async:!0,url:w.PUBLIC_SERVER+"backend/widget_event.php",data:{type:e,widget_key:w.W.widget_key,user_id:w.W.user_id,guid:w.getCookie(w.cg).guid,ga_cid:w.getGoogleCid(),ya_cid:w.ya_cid,ya_counter:w.ya_counter,roistat:w.Cookies.get("roistat_visit")||(void 0!==window.roistat?window.roistat.visit:""),comagic_session_id:w.getComagicSessionId(),ref:document.referrer,loc:document.location.href,cache:Math.random()},success:function(){return w.log("Event Stat ["+e+"] Success")},error:function(){return w.log("Event Stat ["+e+"] Error!")},dataType:"jsonp",jsonpCallback:"jsonpEventCallback_"+e})},w.getComagicSessionId=function(){return window.Comagic&&"function"==typeof window.Comagic.getSessionId?(w.log("!!! Getting comagic",window.Comagic,window.Comagic.getSessionId()),window.Comagic.getSessionId()):""},w.analytics=function(e){return w.log("sendAnalytics",e),w.$.ajax({type:"GET",async:!0,url:w.PUBLIC_SERVER+"backend/widget_analytics.php",data:{data:e,cache:Math.random()},success:function(){},error:function(){},dataType:"jsonp",jsonpCallback:"jsonpAnalyticsCallback"})},w.sendGoal=function(e,t){if(w.log("Call sendGoal"),!1!==w.Events._callEvent("onGoalEvent",{goal:e,params:t})){if(w.log("Send GOAL GA:"+e),"function"==typeof ga&&(ga("send","event",e,"clicked"),ga("ldbckTracker.send","event",e,"clicked")),"function"==typeof gtag&&gtag("event",e,{event_category:e,event_action:"clicked"}),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:e}),0<w.ya.length)for(var o=w.ya.length-1;0<=o;o--)w.log("Send GOAL YA("+w.ya[o]+"):"+e),window[w.ya[o]].reachGoal(e);"LEADBACK_CALL"==e&&""!=w.W.facebook_pixel_event&&(w.log("track fb event "+w.W.facebook_pixel_event),""!=w.W.facebook_pixel_id?(t='<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id='+encodeURIComponent(w.W.facebook_pixel_id)+"&ev="+encodeURIComponent(w.W.facebook_pixel_event)+'&noscript=1"/>',w.log("nonscript pixel"),w.$("body").append(t)):"function"==typeof fbq?fbq("track",w.W.facebook_pixel_event):w.log("need pixel ID"))}},w.getPhonePrefix=function(){var e,t={ru:"+7",ua:"+380",by:"+375",kz:"+77",ge:"+995"},o="";for(e in void 0!==w.W&&(o=w.W.country),t)if(e==o)return t[o];return""},w.getTz=function(){return-(new Date).getTimezoneOffset()/60},w.load_jQuery=function(){var e;w.log("load_jQuery");var t={jquery:"none",widget:_emv.campaign};return void 0!==window.jQuery&&(w.log("Site use jquery "+window.jQuery.fn.jquery),t.jquery=window.jQuery.fn.jquery),void 0!==window.jQuery&&(e=window.jQuery.fn.jquery,0<=inArray.call(w.JQUERY_VERSIONS,e))?(w.log("jQuery "+jQuery.fn.jquery+" is present and meets our requirements."),w.$=window.jQuery,w.init(),w.analytics(t)):(w.log("jQuery is not present."),w.getScript(w.JQUERY_URL,function(){if("undefined"!=typeof jQuery)return w.$=jQuery.noConflict(!0),w.log("jQuery version "+w.$.fn.jquery+" successfully loaded."),w.init(),w.analytics(t)}))},w.getScript=function(e,t){var o,i,n;return w.log("getScript",e),(n=document.createElement("script")).src=e,i=document.getElementsByTagName("head")[0],o=!1,n.onload=n.onreadystatechange=function(){if(!(o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState))return o=!0,t(),n.onload=n.onreadystatechange=null,i.removeChild(n)},i.appendChild(n)},w.loadScript=function(e,t,o){var i,n,a,l;return w.log("loadScript",e),n=!1,a=null,(i=w.$).isFunction(t)?(a=t,n=o||n):(n=t||n,a=o||a),l=!0,i('script[type="text/javascript"]').each(function(){return l=e!==i(this).attr("src")}),l?i.ajax({type:"GET",url:e,success:a,dataType:"script",cache:n}):i.isFunction(a)?a.call(this):void 0},w.generateUUID=function(){var o,e;return w.log("generateUUID"),o=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(o+16*Math.random())%16|0;return o=Math.floor(o/16),("x"===e?t:7&t|8).toString(16)}),w.sendUUID(e),e},w.sendUUID=function(e){w.log("sendUUID",e,_emv.campaign),w.$.ajax({type:"GET",url:w.PUBLIC_SERVER+"backend/widget_uuid.php",dataType:"json",data:{widget_key:_emv.campaign,uuid:e,ga_cid:w.getGoogleCid(),ya_cid:w.ya_cid,ya_counter:w.ya_counter,roistat:w.Cookies.get("roistat_visit")||(void 0!==window.roistat?window.roistat.visit:""),comagic_session_id:w.getComagicSessionId(),ref:document.referrer,loc:document.location.href,cache:Math.random()},success:function(e){w.log("UUID",e)},error:function(){w.log("UUID error")},dataType:"jsonp",jsonpCallback:"jsonpUuidCallback"})},w.isMobile=function(){return!w.is_vk&&(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|playbook|silk/i.test(navigator.userAgent||navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||navigator.vendor||window.opera).substr(0,4)))},w.isIpad=function(){return/ipad/i.test(navigator.userAgent||navigator.vendor||window.opera)},w.isIOS=function(){return/ip(hone|od|ad)/i.test(navigator.userAgent||navigator.vendor||window.opera)},w.isTouch=function(){return"ontouchstart"in window||navigator.maxTouchPoints||window.DocumentTouch&&document instanceof DocumentTouch},w.mobileButton=function(e,t){w.log("call mobileButton");var o=80/w.screen_width,i=window.innerWidth*o,n=window.innerWidth/2-.5*i+window.pageXOffset,o=window.innerHeight-1.25*i+window.pageYOffset;null!==e&&(e.css("width",i),e.css("height",i),e.css("left",n),e.css("top",o),e.find("object").css("width",i),e.find("img").css("width",i)),t.css("width",w.screen_width+"px"),t.css("height",w.screen_height+"px");i=w.screen_width/window.innerWidth;t.css("zoom",1/i),t.css("top",window.pageYOffset*i),t.css("left",window.pageXOffset*i)},w.default_viewport=null,w.default_viewport_is_mobile=!1,w.mobileAdoptation=function(){if(w.$("html").hasClass("lb-site-hide"))w.$("html").removeClass("lb-site-hide"),!1===w.default_viewport?w.$("meta[name=viewport]").attr("content","width=device-width, initial-scale=0.33"):w.default_viewport&&w.$("meta[name=viewport]").attr("content",w.default_viewport),(e=w.$("html").data("ldbck_save_scroll"))&&w.$(document).scrollTop(e);else{var e=w.$(document).scrollTop();if(w.$("html").data("ldbck_save_scroll",e),w.$("html").addClass("lb-site-hide"),0==w.$("meta[name=viewport]").length)w.default_viewport=!1,w.$("head").append('<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">');else if(null===w.default_viewport){w.default_viewport=w.$("meta[name=viewport]").attr("content");for(var t,o=w.default_viewport.split(","),i=!1,n=0;n<o.length;n++){o[n]=o[n].replace(/^\s+/,"");var a=o[n].split("=");"initial-scale"==a[0]&&(t=a[1]),"maximum-scale"==a[0]&&(i=a[1])}if(1==t&&1==i)return void(w.default_viewport_is_mobile=!0);w.$("meta[name=viewport]").attr("content","width=device-width, initial-scale=1, maximum-scale=1")}else w.default_viewport_is_mobile||w.$("meta[name=viewport]").attr("content","width=device-width, initial-scale=1, maximum-scale=1")}var l;"1"!=w.W.chat&&(l=w.$("#lb_mobile-call"),e=w.$(".lb_mobile-wrapper"),l&&e&&w.mobileButton(l,e))},w.escapeHtml=function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})},w.randomVal=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},w.log=function(e){var t;w.debug_window&&((t=document.getElementById("ldbck_debug_window"))||((t=document.createElement("div")).id="ldbck_debug_window",t.style="position: absolute; top: 0; left: 0; width: 100%; background-color: rgba(0,0,0,.2); color: white; z-index:9999;",document.body.appendChild(t)),document.getElementById("ldbck_debug_window").innerHTML+="<div>"+e+": "+JSON.stringify(arguments)+"</div>"),!ldbck.DEBUG&&"#debug"!=window.location.hash||((t=Array.prototype.slice.call(arguments)).unshift((new Date).getHours()+":"+(new Date).getMinutes()+":"+(new Date).getSeconds()+" "),console.log.apply(console,t))},w.initStorage=function(e){return function(d){var e="ls_",t="ss_";function c(e){var t=arguments.length,o=window[e],i=arguments,n=i[1],a,l,r;if(t<2)throw new Error("Minimum 2 arguments must be given");else if(d.isArray(n)){l={};for(var s in n){a=n[s];try{l[a]=JSON.parse(o.getItem(a))}catch(e){l[a]=o.getItem(a)}}return l}else if(t==2)try{return JSON.parse(o.getItem(n))}catch(e){return o.getItem(n)}else{try{l=JSON.parse(o.getItem(n))}catch(e){throw new ReferenceError(n+" is not defined in this storage")}for(var s=2;s<t-1;s++){l=l[i[s]];if(l===undefined)throw new ReferenceError([].slice.call(i,1,s+1).join(".")+" is not defined in this storage")}if(d.isArray(i[s])){r=l;l={};for(var c in i[s])l[i[s][c]]=r[i[s][c]];return l}else return l[i[s]]}}function a(e){var t=arguments.length,o=window[e],i=arguments,n=i[1],a=i[2],l,r={},s;if(t<2||!d.isPlainObject(n)&&t<3)throw new Error("Minimum 3 arguments must be given or second parameter must be an object");else if(d.isPlainObject(n)){for(var c in n){l=n[c];if(!d.isPlainObject(l))o.setItem(c,l);else o.setItem(c,JSON.stringify(l))}return n}else if(t==3){if(typeof a==="object")o.setItem(n,JSON.stringify(a));else o.setItem(n,a);return a}else{try{s=o.getItem(n);if(s!=null)r=JSON.parse(s)}catch(e){}s=r;for(var c=2;c<t-2;c++){l=i[c];if(!s[l]||!d.isPlainObject(s[l]))s[l]={};s=s[l]}s[i[c]]=i[c+1];o.setItem(n,JSON.stringify(r));return r}}function n(e){var t=arguments.length,o=window[e],i=arguments,n=i[1],a,l;if(t<2)throw new Error("Minimum 2 arguments must be given");else if(d.isArray(n)){for(var r in n)o.removeItem(n[r]);return true}else if(t==2){o.removeItem(n);return true}else{try{a=l=JSON.parse(o.getItem(n))}catch(e){throw new ReferenceError(n+" is not defined in this storage")}for(var r=2;r<t-1;r++){l=l[i[r]];if(l===undefined)throw new ReferenceError([].slice.call(i,1,r).join(".")+" is not defined in this storage")}if(d.isArray(i[r]))for(var s in i[r])delete l[i[r][s]];else delete l[i[r]];o.setItem(n,JSON.stringify(a));return true}}function o(e,t){var o=u(e);for(var i in o)n(e,o[i]);if(t)for(var i in d.namespaceStorages)l(i)}function r(e){var t=arguments.length,o=arguments,i=window[e],n=o[1];if(t==1)return u(e).length==0;else if(d.isArray(n)){for(var a=0;a<n.length;a++)if(!r(e,n[a]))return false;return true}else try{var l=c.apply(this,arguments);if(!d.isArray(o[t-1]))l={totest:l};for(var a in l)if(!(d.isPlainObject(l[a])&&d.isEmptyObject(l[a])||d.isArray(l[a])&&!l[a].length||!l[a]))return false;return true}catch(e){return true}}function s(e){var t=arguments.length,o=arguments,i=window[e],n=o[1];if(t<2)throw new Error("Minimum 2 arguments must be given");if(d.isArray(n)){for(var a=0;a<n.length;a++)if(!s(e,n[a]))return false;return true}else try{var l=c.apply(this,arguments);if(!d.isArray(o[t-1]))l={totest:l};for(var a in l)if(!(l[a]!==undefined&&l[a]!==null))return false;return true}catch(e){return false}}function u(e){var t=arguments.length,o=window[e],i=arguments,n=i[1],a=[],l={};if(t>1)l=c.apply(this,i);else l=o;if(l&&l._cookie){for(var r in d.cookie())if(r!="")a.push(r.replace(l._prefix,""))}else for(var s in l)a.push(s);return a}function l(e){if(!e||typeof e!="string")throw new Error("First parameter must be a string");if(g){if(!window.localStorage.getItem(e))window.localStorage.setItem(e,"{}");if(!window.sessionStorage.getItem(e))window.sessionStorage.setItem(e,"{}")}else{if(!window.localCookieStorage.getItem(e))window.localCookieStorage.setItem(e,"{}");if(!window.sessionCookieStorage.getItem(e))window.sessionCookieStorage.setItem(e,"{}")}var t={localStorage:d.extend({},d.localStorage,{_ns:e}),sessionStorage:d.extend({},d.sessionStorage,{_ns:e})};d.namespaceStorages[e]=t;return t}function i(e){var t="jsapi";try{if(!window[e])return false;window[e].setItem(t,t);window[e].removeItem(t);return true}catch(e){return false}}var g=i("localStorage"),h={_type:"",_ns:"",_callMethod:function(e,t){var o=[this._type],t=Array.prototype.slice.call(t),i=t[0];if(this._ns)o.push(this._ns);if(typeof i==="string"&&i.indexOf(".")!==-1){t.shift();[].unshift.apply(t,i.split("."))}[].push.apply(o,t);return e.apply(this,o)},get:function(){return this._callMethod(c,arguments)},set:function(){var e=arguments.length,t=arguments,o=t[0];if(e<1||!d.isPlainObject(o)&&e<2)throw new Error("Minimum 2 arguments must be given or first parameter must be an object");if(d.isPlainObject(o)&&this._ns){for(var i in o)a(this._type,this._ns,i,o[i]);return o}else{var n=this._callMethod(a,t);if(this._ns)return n[o.split(".")[0]];else return n}},remove:function(){if(arguments.length<1)throw new Error("Minimum 1 argument must be given");return this._callMethod(n,arguments)},removeAll:function(e){if(this._ns){a(this._type,this._ns,{});return true}else return o(this._type,e)},isEmpty:function(){return this._callMethod(r,arguments)},isSet:function(){if(arguments.length<1)throw new Error("Minimum 1 argument must be given");return this._callMethod(s,arguments)},keys:function(){return this._callMethod(u,arguments)}};if(d.initNamespaceStorage=function(e){return l(e)},g){d.localStorage=d.extend({},h,{_type:"localStorage"});d.sessionStorage=d.extend({},h,{_type:"sessionStorage"})}else{d.localStorage=d.extend({},h,{_type:"localCookieStorage"});d.sessionStorage=d.extend({},h,{_type:"sessionCookieStorage"})}d.namespaceStorages={},d.removeAllStorages=function(e){d.localStorage.removeAll(e);d.sessionStorage.removeAll(e);if(d.cookieStorage)d.cookieStorage.removeAll(e);if(!e)d.namespaceStorages={}}}(w.$),w.$.initNamespaceStorage("__"+e)},w.coBrowseV2=function(i){w.log("coBrowseV2"),Cloudim.Api.getCurrentOperator(function(o){!1!==o&&void 0===o.length&&Cloudim.Api.getVisitor(function(e){var t=w.$("html").clone();t.find("script").attr("src","").html(""),t.find(".app-cobrowsing").remove(),t.find("#lb_widget-root").html(""),t.find("audio").html(""),t.find("iframe#cloudim_chat").html("");t={widget_key:w.W.widget_key,user_id:w.W.user_id,guid:w.getCookie(w.cg).guid,loc:document.location.href,operator:o.jid,visitor:e.jid,html:t.html()};w.$.post(w.PUBLIC_SERVER+"backend/widget_cobrowse.php",t,function(e){"function"==typeof i&&i(e)},"json")})})},w.Cookies=function e(h){function m(e,t,o){var i,n;if("undefined"!=typeof document){if(1<arguments.length){"number"==typeof(o=_({path:"/"},m.defaults,o)).expires&&((n=new Date).setMilliseconds(n.getMilliseconds()+864e5*o.expires),o.expires=n),o.expires=o.expires?o.expires.toUTCString():"";try{i=JSON.stringify(t),/^[\{\[]/.test(i)&&(t=i)}catch(e){}t=h.write?h.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=(e=(e=encodeURIComponent(String(e))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var a,l="";for(a in o)o[a]&&(l+="; "+a,!0!==o[a]&&(l+="="+o[a]));return document.cookie=e+"="+t+l}e||(i={});for(var r=document.cookie?document.cookie.split("; "):[],s=/(%[0-9A-Z]{2})+/g,c=0;c<r.length;c++){var d=r[c].split("="),u=d.slice(1).join("=");this.json||'"'!==u.charAt(0)||(u=u.slice(1,-1));try{var g=d[0].replace(s,decodeURIComponent),u=h.read?h.read(u,g):h(u,g)||u.replace(s,decodeURIComponent);if(this.json)try{u=JSON.parse(u)}catch(e){}if(e===g){i=u;break}e||(i[g]=u)}catch(e){}}return i}}return(m.set=m).get=function(e){return m.call(m,e)},m.getJSON=function(){return m.apply({json:!0},[].slice.call(arguments))},m.defaults={},m.remove=function(e,t){m(e,"",_(t,{expires:-1}))},m.withConverter=e,m}(function(){}),w.Events={onChatReady:[],onGoalEvent:[],_callEvent:function(e,t){var o=!0;if(void 0!==w.Events[e]&&0<w.Events[e].length)for(var i in w.Events[e])!1===w.Events[e][i](t)&&(o=!1);return o}},w.Api={callTo:function(e,t){t=t&&"object"!=typeof t?{delayed:t}:t;w.$("#lb_phone").val(e),w.callTo(w.$("#lb_widget-root"),t)},callFromForm:function(e,t){w.$("#lb_phone").val(e);e={initiator:"magic_forms"};t&&"string"==typeof t&&""!==w.$.trim(t)&&(e.label=t),w.callTo(w.$("#lb_widget-root"),e)},bind:function(e,t){w.Events[e]&&(w.Events[e][w.Events[e].length]=t)}},0<w.onApiReady.length)for(n=0,l=w.onApiReady.length;n<l;n++)"function"==typeof w.onApiReady[n]&&w.onApiReady[n](w.Api);"object"==typeof window.Muse&&"function"==typeof window.muse_init?(w.log("Is Muse site"),w.muse_detect_interval=null,w.muse_interval=150,w.muse_stop_check=5e3,w.muse_step=0,w.muse_detect_interval=setInterval(function(){w.muse_step++,(!0===document.body.classList.contains("initialized")||w.muse_step>=w.muse_stop_check/w.muse_interval)&&(w.log("Muse Is initialized"),clearInterval(w.muse_detect_interval),w.muse_detect_interval=null,w.load_jQuery())},w.muse_interval)):w.load_jQuery()}.call(this);