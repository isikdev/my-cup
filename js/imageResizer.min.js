var ImageResizer;(function(d){var g={maxWidth:500,maxHeight:500,resize:true,sharpen:0.15,jpgQuality:0.9,convertToJpg:false,convertToJpgBgColor:"#FFFFFF",returnFileObject:true,upscale:false,debug:false,renameFile:true};function f(k,j,i){if(!Modernizr.blobconstructor){if(j.debug){console.info("Blob constructor not supported by this browser. Can't resize or compress image.")}i(k);return}if(!Modernizr.canvas){if(j.debug){console.info("Canvas 2D drawing not supported by this browser. Can't resize or compress image.")}i(k);return}if(b(j)){return}if(j.debug){console.log("Processing image: '"+k.name+"'")}var l=c({},g,j);var h=document.createElement("img");h.onload=function(){var w,p;var u,C;w=p=h.width;u=C=h.height;var B=false;if(l.resize){if(w>u){if(w>l.maxWidth||l.upscale){u=Math.round(u*l.maxWidth/w);w=l.maxWidth;B=true}}else{if(u>l.maxHeight||l.upscale){w=Math.round(w*l.maxHeight/u);u=l.maxHeight;B=true}}}console.log((B?"Resizing from "+p+"x"+C+"px to "+w+"x"+u+"px":"Resizing not required. Image smaller than max dimensions or resizing disabled."));if(B||l.jpgQuality!=1){var o=document.createElement("canvas");var y=o.getContext("2d");o.width=w;o.height=u;console.log(k.type);if(l.convertToJpg&&(k.type=="image/png"||k.type=="image/svg+xml")){if(j.debug){console.log("Convertig PNG/SVG to JPG with background-color: "+l.convertToJpgBgColor)}y.fillStyle=l.convertToJpgBgColor;y.fillRect(0,0,w,u)}var A;if(w>u){A=Math.ceil(Math.log(h.width/w)/Math.log(2))}else{A=Math.ceil(Math.log(h.height/u)/Math.log(2))}if(A>1){var x=document.createElement("canvas"),q=x.getContext("2d");var v,t;x.width=v=h.width*0.5;x.height=t=h.height*0.5;q.drawImage(h,0,0,x.width,x.height);for(var z=2;z<A;z++){v*=0.5;t*=0.5;q.drawImage(x,0,0,x.width*0.5,x.height*0.5)}y.drawImage(x,0,0,v,t,0,0,o.width,o.height)}else{y.drawImage(h,0,0,w,u)}if(l.sharpen>0){if(j.debug){console.log("Sharpening image "+(l.sharpen*100)+"%")}e(y,o.width,o.height,l.sharpen)}var r,n;if(!l.convertToJpg&&(k.type=="image/png"||k.type=="image/svg+xml")){r=o.toDataURL("image/png");n="png"}else{if(j.debug){console.log("Setting jpeg-quality to: "+l.jpgQuality)}r=o.toDataURL("image/jpeg",l.jpgQuality);n="jpg"}var m=a(r);if(Modernizr.filesystem&&l.returnFileObject){var D;if(l.renameFile){var E=k.name.replace(/\.[^/.]+$/,"");D=E+(B?"_resized":"")+(l.jpgQuality!=1?"_compressed":"")+"."+n;if(j.debug){console.log("Renaming file from '"+k.name+"' to '"+D+"'")}}else{D=k.name}var s=new File([m],D,{type:m.type,lastModified:(new Date()).getTime()});if(j.debug){console.log("Finished processing. Returning File object: \n  name: "+s.name+"\n  lastModified: "+s.lastModifiedDate+"\n  size: "+s.size+"\n  type: "+s.type)}i(s)}else{if(!Modernizr.filesystem&&j.debug){console.info("Browser doesn't support File API")}if(j.debug){console.log("Finished processing. Returning Blob object:\n  size: "+m.size+"\n  type: "+m.type)}i(m)}}else{if(j.debug){console.log("Image smaller than max-dimensions")}i(k)}};h.src=window.URL.createObjectURL(k)}d.resizeImage=f;function e(v,o,E,p){var G=[0,-1,0,-1,5,-1,0,-1,0],q=Math.round(Math.sqrt(G.length)),B=(q*0.5)|0,K=v.createImageData(o,E),H=K.data,C=v.getImageData(0,0,o,E).data,l=E;while(l--){var m=o;while(m--){var s=l,u=m,z=(l*o+m)*4,t=0,F=0,I=0,J=0;for(var j=0;j<q;j++){for(var k=0;k<q;k++){var A=s+j-B;var D=u+k-B;if(A>=0&&A<E&&D>=0&&D<o){var n=(A*o+D)*4;var i=G[j*q+k];t+=C[n]*i;F+=C[n+1]*i;I+=C[n+2]*i;J+=C[n+3]*i}}}H[z]=t*p+C[z]*(1-p);H[z+1]=F*p+C[z+1]*(1-p);H[z+2]=I*p+C[z+2]*(1-p);H[z+3]=C[z+3]}}v.putImageData(K,0,0)}function a(o){var h=";base64,";if(o.indexOf(h)==-1){var n=o.split(",");var p=n[0].split(":")[1];var j=decodeURIComponent(n[1]);return new Blob([j],{type:p})}var n=o.split(h);var p=n[0].split(":")[1];var j=window.atob(n[1]);var m=j.length;var l=new Uint8Array(m);for(var k=0;k<m;++k){l[k]=j.charCodeAt(k)}return new Blob([l],{type:p})}function c(m,l,h){for(var k=1;k<arguments.length;k++){for(var j in arguments[k]){if(arguments[k].hasOwnProperty(j)){arguments[0][j]=arguments[k][j]}}}return arguments[0]}function b(h){if(h.jpgQuality<0||h.jpgQuality>1){console.error("Option 'jpgQuality' must be between 0 and 1");return true}if(h.sharpen<0||h.sharpen>1){console.error("Option 'sharpen' must be between 0 and 1");return true}}})(ImageResizer||(ImageResizer={}));